@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Purple Admin</title>
    <!-- plugins:css -->
    <link rel="stylesheet" href="~/vendors/mdi/css/materialdesignicons.min.css">
    <link rel="stylesheet" href="~/vendors/css/vendor.bundle.base.css">
    <!-- endinject -->
    <!-- Plugin css for this page -->
    <!-- End plugin css for this page -->
    <!-- inject:css -->
    <!-- endinject -->
    <!-- Layout styles -->
    <link rel="stylesheet" href="~/css/style.css">
    <link rel="stylesheet" href="~/css/custom.css">
    <!-- End layout styles -->

    <link rel="shortcut icon" href="~/images/favicon.ico" />
</head>

<body>
    <div class="container-scroller">
        <div class="container-fluid page-body-wrapper full-page-wrapper">
            <div class="content-wrapper d-flex align-items-center auth">
                <div class="row flex-grow">
                    <div class="col-lg-4 mx-auto">
                        <div class="auth-form-light text-left p-5">
                            <div class="brand-logo">
                                <img src="~/images/LogoVitaNutri.jpg">
                            </div>
                            <h4 style="font-family: 'Roboto', sans-serif;">Bạn mới ở đây à?</h4>
                            <h6 class="font-weight-light" style="font-family: 'Roboto', sans-serif;">Đăng ký rất dễ
                                dàng. Chỉ mất vài bước</h6>
                            <form class="pt-3" asp-action="Register" method="post" id="registerForm">
                                <div class="form-group">
                                    <input style="font-family: 'Roboto', sans-serif;" type="text"
                                        class="form-control form-control-lg" id="firstName" placeholder="Tên gọi"
                                        name="firstName" required minlength="1" maxlength="50">
                                </div>
                                <div class="form-group">
                                    <input style="font-family: 'Roboto', sans-serif;" type="text"
                                        class="form-control form-control-lg" id="lastName" placeholder="Tên đệm"
                                        name="lastName" required minlength="1" maxlength="50">
                                </div>
                                <div class="form-group">
                                    <input style="font-family: 'Roboto', sans-serif;" type="text"
                                        class="form-control form-control-lg" id="exampleInputUsername1"
                                        placeholder="Tài khoản" name="account" required minlength="6" maxlength="50">
                                    <small style="font-family: 'Roboto', sans-serif;" id="accountHelp"
                                        class="form-text text-muted">Tài khoản phải có từ 6 đến 50 ký tự.</small>
                                </div>
                                <div class="form-group">
                                    <input style="font-family: 'Roboto', sans-serif;" type="password"
                                        class="form-control form-control-lg" id="password" placeholder="Mật khẩu"
                                        name="password" required minlength="6" maxlength="50">
                                    <small style="font-family: 'Roboto', sans-serif;" id="passwordHelp"
                                        class="form-text text-muted">Mật khẩu phải có từ 6 đến 50 ký tự.</small>
                                </div>
                                <div class="form-group">
                                    <input style="font-family: 'Roboto', sans-serif;" type="password"
                                        class="form-control form-control-lg" id="confirmPassword"
                                        placeholder="Nhập lại mật khẩu" name="confirm" required minlength="6"
                                        maxlength="50">
                                    <small style="font-family: 'Roboto', sans-serif;" id="confirmPasswordHelp"
                                        class="form-text text-muted">Phải trùng với mật khẩu ở trên.</small>
                                </div>
                                <div class="form-group">
                                    <input style="font-family: 'Roboto', sans-serif;" type="email"
                                        class="form-control form-control-lg" placeholder="Gmail" name="accountGoogle"
                                        required
                                        title="Vui lòng nhập một địa chỉ Gmail hợp lệ (ví dụ: example@gmail.com)"
                                        minlength="6" maxlength="50">
                                    <small style="font-family: 'Roboto', sans-serif;" id="accountHelp"
                                        class="form-text text-muted">
                                        Tài khoản phải có từ 6 đến 50 ký tự và là địa chỉ Gmail hợp lệ.
                                    </small>
                                </div>


                                <!-- Thêm phần nhập mã xác nhận -->
                                <div class="form-group">
                                    <input style="font-family: 'Roboto', sans-serif;" type="text" class="form-control form-control-lg"
                                           id="verificationCode" placeholder="Nhập mã xác nhận" name="verificationCode" required minlength="6" maxlength="6" disabled>
                                </div>

                                <!-- Thêm nút gửi mã -->
                                <div class="mb-4">
                                    <button type="button" id="sendVerificationCode" class="btn btn-gradient-primary btn-lg btn-block">
                                        Gửi mã xác nhận
                                    </button>
                                </div>

                                <!-- Nút đăng ký -->
                                <div class="mt-3">
                                    <button id="registerButton" style="font-family: 'Roboto', sans-serif;"
                                            class="btn btn-block btn-gradient-primary btn-lg font-weight-medium auth-form-btn"
                                            type="submit" disabled>
                                        ĐĂNG KÍ
                                    </button>
                                </div>




                                @* <div class="form-group">
                                    <input style="font-family: 'Roboto', sans-serif;" type="text" class="form-control form-control-lg" id="googleAccAuthentication" placeholder="Nhập mã xác thực" name="googleAccAuthentication" required minlength="1" maxlength="50">
                                </div> *@
                                <div class="mb-4">
                                    <div class="form-check">
                                        <label class="form-check-label text-muted">
                                            @* <input type="checkbox" class="form-check-input" name="terms" required> I agree to all Terms & Conditions *@
                                        </label>
                                    </div>
                                </div>
                                <div class="text-center mt-4 font-weight-light"
                                    style="font-family: 'Roboto', sans-serif;">
                                    Đã có tài khoản? <a href="@Url.Action("Login", "Home")" class="text-primary"
                                        style="font-family: 'Roboto', sans-serif;">Đăng nhập</a>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <!-- content-wrapper ends -->
        </div>
        <!-- page-body-wrapper ends -->
    </div>
    <!-- container-scroller -->
    <!-- plugins:js -->
    <script src="~/vendors/js/vendor.bundle.base.js"></script>
    <!-- endinject -->
    <!-- Plugin js for this page -->
    <!-- End plugin js for this page -->
    <!-- inject:js -->
    <script src="~/js/off-canvas.js"></script>
    <script src="~/js/hoverable-collapse.js"></script>
    <script src="~/js/misc.js"></script>
    <!-- endinject -->
</body>

</html>

@if (ViewBag.AlertMessage != null)
{
    <script>
    alert("@System.Web.HttpUtility.JavaScriptStringEncode(ViewBag.AlertMessage)");
</script>
}



<script>
    document.getElementById('sendVerificationCode').addEventListener('click', function () {
        var email = document.querySelector('[name="accountGoogle"]').value;

        if (!email) {
            alert("Vui lòng nhập địa chỉ Gmail!");
            return;
        }

        // Tạo mã xác nhận ngẫu nhiên
        var verificationCode = Math.floor(100000 + Math.random() * 900000); // 6 chữ số ngẫu nhiên
        const apiURL = "@ViewBag.APIBaseAddress".replace(/&amp;/g, '&');

        // https://localhost:7045/api/Users/APIGoogleAccountVerificationCode?emailGoogle=deluudulieu999%40gmail.com&verificationCode=3453453
        // Gửi mã xác nhận tới API
        fetch(apiURL + '/Users/APIGoogleAccountVerificationCode?emailGoogle=' + encodeURIComponent(email) + '&verificationCode=' + verificationCode)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert("Mã xác nhận đã được gửi đến Gmail của bạn!");
                    document.getElementById('verificationCode').disabled = false; // Bật ô nhập mã
                    window.localStorage.setItem('verificationCode', verificationCode); // Lưu mã vào localStorage
                } else {
                    alert("Lỗi gửi mã xác nhận. Vui lòng thử lại!");
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert("Có lỗi xảy ra khi gửi mã xác nhận!");
            });
    });

    document.getElementById('verificationCode').addEventListener('input', function () {
        var inputCode = document.getElementById('verificationCode').value;
        var storedCode = window.localStorage.getItem('verificationCode');

        if (inputCode === storedCode) {
            document.getElementById('registerButton').disabled = false; // Cho phép nhấn nút đăng ký
        } else {
            document.getElementById('registerButton').disabled = true; // Vô hiệu nút đăng ký nếu mã không khớp
        }
    });
</script>
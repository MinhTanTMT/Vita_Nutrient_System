@model IEnumerable<SlotBranch>

<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Tailwind CSS Example</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@latest/dist/tailwind.min.css"
          rel="stylesheet" />

    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="~/css/style3.css" rel="stylesheet" />
</head>
<body class="bg-gray-100 font-sans">
    <div class="container mx-auto p-4 px-8 pb-24">
        <!-- Nút ngày chỉnh sửa  -->
        <div class="mx-2 flex justify-end">
            <button class="edit_date_btn text-white font-bold py-2 px-4 rounded-md border">
                Ngày chỉnh sửa
            </button>
        </div>
        <!-- Header -->
        <div class="flex justify-start items-center mb-6 mt-2 gap-8">
            <div class="flex border border-gray-300 rounded-lg p-1">
                <button id="day-btn" class="day-btn w-full py-2 px-4 text-white rounded-md">
                    Ngày
                </button>
                <button id="week-btn"
                        class="w-full py-2 px-4 bg-white text-gray-700 rounded-md">
                    Tuần
                </button>
            </div>
            <div class="flex items-center space-x-4">
                <button>
                    <i class="fa-solid fa-chevron-left"></i>
                </button>
                <button class="bg-gray-100 p-2 rounded-full">
                    <i class="fa-regular fa-calendar"></i>
                </button>
                <button>
                    <i class="fa-solid fa-chevron-right"></i>
                </button>
            </div>
            <h1 class="text-xl font-bold">Hôm nay</h1>
        </div>


        <!-- Main Content -->
        @{
            double totaAllCalories = Math.Round(ViewBag.foodListTotaAllCalculated.ingredientDetails100gReduceDTO.energy, 2) ; // Thay bằng giá trị đã tính toán
            double caloriesEaten = Math.Round(ViewBag.foodListEatenCalculated.ingredientDetails100gReduceDTO.energy, 2); // Thay bằng giá trị đã tính toán
            double caloriesRemaining = totaAllCalories - caloriesEaten; // Tự động tính phần còn lại

            // Tính phần trăm lượng calo đã tiêu thụ so với tổng lượng calo
            double percentEaten = (caloriesEaten / totaAllCalories) * 100;
        }

        <div class="progress-container">
            <div id="progress-bar" class="progress-bar"></div>
        </div>

        <p>Calories Eaten: @caloriesEaten / @totaAllCalories Cal</p>

        <!-- CSS cho thanh tiến trình -->
        <style>
            .progress-container {
                width: 100%;
                background-color: #e0e0e0;
                border-radius: 8px;
                height: 24px;
                overflow: hidden;
            }

            .progress-bar {
                height: 100%;
                width: 0;
                background-color: #4CAF50;
                border-radius: 8px;
                transition: width 0.3s ease;
            }
        </style>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                // Lấy phần trăm calo đã tiêu thụ từ Razor
                var percentEaten = @percentEaten;

                // Lấy phần tử thanh tiến trình
                var progressBar = document.getElementById("progress-bar");

                // Cập nhật chiều rộng của thanh tiến trình
                progressBar.style.width = percentEaten + "%";

                // Cập nhật màu sắc của thanh tiến trình dựa trên phần trăm
                if (percentEaten <= 50) {
                    progressBar.style.backgroundColor = "#FFBB33"; // Màu vàng nhạt cho dưới 50%
                } else if (percentEaten <= 80) {
                    progressBar.style.backgroundColor = "#FF8800"; // Màu cam cho từ 50% đến 80%
                } else {
                    progressBar.style.backgroundColor = "#FF4444"; // Màu đỏ cho trên 80%
                }
            });
        </script>



        <div class="flex space-x-6 relative min-h-screen">
            <!-- Left: Meals -->
            <div class="flex-1 space-y-6">
                <!-- Header Left -->
                <div class="flex justify-between">
                    <div class="flex gap-32">
                        <h2 class="text-lg font-bold">Bữa Ăn</h2>
                        <div class="flex gap-1">
                            <img src="~/icons/chart-pie.svg"
                                 alt="Pie chart"
                                 width="20px" />
                            <h6>@Math.Round(ViewBag.foodListTotaAllCalculated.ingredientDetails100gReduceDTO.energy, 2) Calo</h6>
                        </div>
                    </div>
                    <div class="flex gap-8">
                        <button onclick="event.preventDefault(); document.getElementById('refreshTheMeal').submit();">
                            <i class="fa-sharp fa-solid fa-rotate"></i>
                        </button>

                        <form asp-controller="User" asp-action="RefreshTheMeal" method="post" id="refreshTheMeal" style="display:none;">
                            <button type="submit">refreshTheMeal</button>
                        </form>


                        <!-- NutChuyen-->

                        <button><i class="fa-solid fa-ellipsis-vertical"></i></button>
                    </div>
                </div>
                <!-- Meal Item  bua sang-->
                @foreach (var item in Model)
                {
                    <div class="meal-item rounded-2xl shadow p-4">
                        <div class="flex flex-row mb-2 justify-between items-center" >
                            <div>
                                <h2 class="text-lg font-bold">@item.NameSlotOfTheDay</h2>
                                <div class="flex gap-2">
                                    <img src="~/icons/chart-pie.svg"
                                         alt="Pie chart"
                                         width="20px" />
                                    <p class="text-blue-500 font-semibold">@item.TotalCaloriesPerMeal calo</p>
                                </div>
                            </div>

                            <div class="flex gap-8">
                                <button>
                                    <i class="fa-solid fa-backward"></i>
                                </button>
                                <button><i class="fa-solid fa-ellipsis-vertical"></i></button>
                            </div>
                        </div>



                        @foreach (var item2 in item.foodDataOfSlot)
                        {
                            <p style="margin-bottom: 10px;">---------</p>
                            @foreach (var item3 in item2.foodIdData)
                            {


                                <ul class="space-y-2 ml-4" onclick="document.getElementById('GetMealDetail').submit();">
                                    <li class="flex items-center space-x-2 gap-4">
                                        <div class="flex items-center gap-3">
                                            <input type="checkbox" class="h-6 w-6"
                                            @(item3.statusSymbol.Equals("+") ? "checked" : "")
                                            @(item3.statusSymbol.Equals("!") ? "disabled" : "") />
                                            <img src="~/images/@item3.foodData.urlimage"
                                                 alt="meal"
                                                 class="rounded-lg w-18 h-16" />
                                        </div>
                                        <div class="flex flex-col">
                                            <span class="text-lg font-medium"> @item3.foodData.name </span>
                                            <span>@Math.Round(item3.foodData.ingredientDetails100gReduceDTO.energy, 2) Calo</span>
                                        </div>
                                        <button><i class="fa-solid fa-ellipsis-vertical" onclick="openMenu();"></i></button>
                                    </li>
                                </ul>

                                <form asp-controller="Meal" asp-action="MealDetail/@item3.idFood" method="post" id="GetMealDetail" style="display:none;">
                                    <button type="submit">GetMealDetail</button>
                                </form>

                                <script>
                                    // Hàm sự kiện riêng cho nút `fa-ellipsis-vertical`
                                    function openMenu() {
                                        event.stopPropagation(); // Ngăn sự kiện lan lên div cha
                                        // Thực hiện hành động riêng, ví dụ mở menu hoặc hiển thị thông báo
                                        alert("Menu opened!");
                                    }
                                </script>

                                <p style="margin-bottom: 3px;"/>
                            }
                        }
                    </div>
                }
            </div>

            <!-- Right: Nutrition Info -->
            <div class="w-2/5 bg-white rounded-lg shadow p-4 h-full">
                <div class="flex flex-row justify-between">
                    <h3 class="text-lg font-bold mb-4">Dinh dưỡng</h3>
                    <div class="flex border border-gray-300 rounded-lg p-1">
                        <button id="day-btn"
                                class="day-btn w-full py-2 px-4 text-white rounded-md">
                            <i class="fa-solid fa-chart-pie"></i>
                        </button>
                        <button id="week-btn"
                                class="w-full py-2 px-4 bg-white text-gray-700 rounded-md">
                            <i class="fa-solid fa-chart-bar"></i>
                        </button>
                    </div>
                </div>
                <div class="mb-4 flex justify-center">
                    <!-- Pie chart placeholder -->
                    <canvas id="myChart" style="width: 300px !important; height: 300px !important"></canvas>

                </div>
                <div class="grid grid-cols-3 gap-4 p-4">
                    <div class="flex flex-col gap-1">
                        <p class="font-bold disabled text-white">Lượng calo</p>
                        <p class="font-bold">Lượng calo</p>
                        <div class="flex items-center" style="margin-bottom: 13px;">
                            <span class="inline-block w-3 h-3 rounded-full bg-yellow-500 mr-2"></span>
                            <span>Carbohydrate</span>
                        </div>
                        <div class="flex items-center" style="margin-bottom: 13px;">
                            <span class="inline-block w-3 h-3 rounded-full bg-blue-500 mr-2"></span>
                            <span>Chất béo</span>
                        </div>
                        <div class="flex items-center mb-5" style="margin-bottom: 13px;">
                            <span class="inline-block w-3 h-3 rounded-full bg-purple-500 mr-2"></span>
                            <span>Chất đạm</span>
                        </div>
                        <p>Chất xơ</p>
                        <p>Natri</p>
                        <p>Cholesterol</p>
                    </div>

                    <!-- Right Column -->
                    <div class="flex flex-col gap-1 text-right">
                        <p class="font-bold">Tổng số</p>
                        <p>@Math.Round(ViewBag.foodListTotaAllCalculated.ingredientDetails100gReduceDTO.energy, 2)</p>
                        <p>@Math.Round(ViewBag.foodListTotaAllCalculated.ingredientDetails100gReduceDTO.carbohydrate, 2) gam</p>
                        <p>@Math.Round(ViewBag.foodListTotaAllCalculated.ingredientDetails100gReduceDTO.fat, 2) g</p>
                        <p class=" mb-5">@Math.Round(ViewBag.foodListTotaAllCalculated.ingredientDetails100gReduceDTO.cholesterol, 2) gam</p>
                        <p>28g</p>
                        <p>4922mg</p>
                        <p>213mg</p>
                    </div>

                    <!-- Right Column (Mục tiêu) -->
                    <div class="flex flex-col gap-1 text-right">
                        <p class="font-bold">Mục tiêu</p>
                        <p>1664</p>
                        <p>16 - 208g</p>
                        <p>49 - 93g</p>
                        <p class=" mb-5">70 - 208g</p>
                        <p>25g</p>
                        <p>-</p>
                        <p>-</p>
                    </div>
                </div>

                <button class="mt-4 w-full bg-green-500 text-white py-2 rounded-2xl border border-black">
                    Thông tin dinh dưỡng chi tiết
                </button>
            </div>
            <div class="absolute bottom-24 -right-8">
                <img src="~/images/heart-gym-remove-bg.png" />
            </div>
        </div>
    </div>

    <!-- Button to Open the Modal -->
    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#foodSelectionModal" >
        Open Food Selection
    </button>

    <!-- The Modal -->
    <div class="modal fade" id="foodSelectionModal" tabindex="-1" aria-labelledby="foodSelectionModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <!-- Modal Header -->
                <div class="modal-header">
                    <h5 class="modal-title" id="foodSelectionModalLabel">Food Selection</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <!-- Modal Body -->
                <div class="modal-body d-flex">
                    <!-- Food List -->
                    <div class="food-list w-50 pe-3 border-end">
                        <div class="mb-3">
                            <input type="text" class="form-control" placeholder="Search...">
                        </div>
                        <ul class="list-group">
                            <li class="list-group-item d-flex align-items-center">
                                <img src="salmon-beet-salad.jpg" alt="Salmon Beet Salad" class="img-thumbnail me-2" style="width: 30px;">
                                Salmon Beet Salad
                            </li>
                            <li class="list-group-item d-flex align-items-center">
                                <img src="spinach-scramble.jpg" alt="Spinach Scramble" class="img-thumbnail me-2" style="width: 30px;">
                                Simple Spinach Scramble
                            </li>
                            <!-- Add more items as necessary -->
                        </ul>
                    </div>

                    <!-- Filter Options -->
                    <div class="filter-options w-50 ps-3">
                        <h6>Filters</h6>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="foodExclusions">
                            <label class="form-check-label" for="foodExclusions">Apply Food Exclusions</label>
                        </div>

                        <h6 class="mt-3">Nutrition Focus</h6>
                        <div class="btn-group" role="group">
                            <button type="button" class="btn btn-outline-secondary">High Protein</button>
                            <button type="button" class="btn btn-outline-secondary">Low Carb</button>
                            <button type="button" class="btn btn-outline-secondary">Low Fat</button>
                            <!-- Add more filters as needed -->
                        </div>

                        <h6 class="mt-3">Meal Type</h6>
                        <div class="btn-group" role="group">
                            <button type="button" class="btn btn-outline-secondary">Main Dish</button>
                            <button type="button" class="btn btn-outline-secondary">Side Dish</button>
                            <!-- Add more options as necessary -->
                        </div>

                        <!-- Additional Filter Categories -->
                        <!-- Add your filter categories similar to above structure -->
                    </div>
                </div>

                <!-- Modal Footer -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Apply Filters</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Bootstrap CSS and JS if not already included -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
<script src="~/js/mainPlanUser.js"></script>
</html>
